<%= form_with model: @post, local: true do |form| %>
  <%= render 'shared/error_message', object: form.object %>
  <div id="postContent" class="flex flex-col items-center mt-4">
    <p class="text-lg font-bold text-center">現在のデスク画像</p>
    <%= image_tag main_image_existence(@post), class: "w-640 object-contain" %>
    <p class="break-words mb-3">新しくデスク画像を登録する場合は、下記からファイルを選択してください。</p>
    <%= form.file_field :image, accept: "image/png, image/jpeg", class: 'file-input file-input-bordered' %>
    <p class="text-center font-bold"><%= form.label :content %></p>
    <%= form.text_area :content, class: "textarea textarea-bordered w-640 h-52" %>
  </div>

  <div class="flex flex-col items-center">
    <p class="text-xl">登録アイテム一覧</p>
    <%= render 'posts/template/form_template', form: form %>
    <div id="gadget-display-item-container" class="grid grid-cols-4 gap-3 grid-flow-row ml-10 mr-10 border p-5">
      <% if @post.gadgets.ids.present? %>
        <% @post.gadgets.each_with_index do |gadget, index| %>
          <div id="subitem_<%= index + 10000 %>" class="border border-gray-200 rounded-lg p-6 shadow bg-white">
            <p id="main_form_genre_display" class="badge badge-ghost text-lg"><%= gadget.genre %></p>
            <img id="main_form_imageUrl_display">
            <%= image_tag gadget.image_url %>
            <div class="flex">
              <p>メーカー：</p>
              <p id="main_form_maker_display"><%= gadget.brand %></p>
            </div>
            <p id="main_form_name_display"><%= gadget.name %></p>
            <p id="main_form_price_display"><%= gadget.price %></p>
            <button type="button" id="main_form_delete_btn_<%= index + 10000 %>" class="btn" data-controller="form-btn" data-action="click->form-btn#delete" data-form-btn-target="deleteBtn">削除</button>
          </div>
        <% end %>
      <% end %>
    </div>
    <div id="gadget-hidden-display-item-container">
      <% if @post.gadgets.ids.present? %>
        <% @post.gadgets.each_with_index do |gadget, index| %>
          <%= form.fields_for :gadgets, gadget, child_index: index do |gadget_form| %>
            <div id="gadget-fields_<%= index + 10000 %>" class="hidden">
              <%= gadget_form.text_field :genre %>
              <%= gadget_form.url_field :image_url %>
              <%= gadget_form.text_field :name %>
              <%= gadget_form.text_field :brand %>
              <%= gadget_form.number_field :price %>
              <%= gadget_form.number_field :_destroy, id: "delete_flag_#{index + 10000}" %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
    <%= form.submit '投稿する', class: 'btn m-6' %>
  </div>
<% end %>
    <%= render 'posts/modal_gadget' %>
