<div class="mx-auto max-w-4xl">
  <%= form_with model: @post, local: true do |form| %>
    <%= render 'shared/error_message', object: form.object %>

    <div class="flex flex-col items-center gap-10 p-3">
      <div id="step1">
        <div class="flex items-center justify-start gap-2">
          <i class="fa-solid fa-caret-down text-2xl ml-1"></i>
          <p class="text-sm md:text-base">STEP1 自分のデスク画像をアップロードしよう！</p>
        </div>
        <div class="border p-5 bg-white rounded-lg">
          <%= image_tag main_image_existence(@post), class: "object-contain border rounded-lg" %>
          <div class="flex flex-col items-center m-5 gap-2">
            <div class="flex items-center gap-2">
              <i class="fa-regular fa-lightbulb"></i>
              <p class="text-sm md:text-base">ここから画像をアップロードしてね！</p>
            </div>
            <%= form.file_field :image, accept: "image/png, image/jpeg", class: 'file-input file-input-bordered file-input-sm md:file-input-md w-full max-w-xs' %>
          </div>
        </div>
      </div>

      <div id="step2" class="w-full">
        <div class="flex items-center justify-start gap-2">
          <i class="fa-solid fa-caret-down text-2xl ml-1"></i>
          <p class="text-sm md:text-base">STEP2 デスクのおすすめポイントを書こう！</p>
        </div>
        <div class="border p-5 bg-white rounded-lg">
          <%= form.label :content %>
          <%= form.text_area :content, class: "base-form-area w-full h-36 md:h-48", placeholder: "ここに自分のデスクのお勧めポイントを書いてね！" %>
        </div>
      </div>

      <div id="step3" class="w-full">
        <div class="flex items-center justify-start gap-2">
          <i class="fa-solid fa-caret-down text-2xl ml-1"></i>
          <p class="text-sm md:text-base">STEP3 使用しているアイテムを追加しよう！</p>
        </div>
        <div class="border px-5 pt-5 pb-20 bg-white rounded-lg">
          <p class="text-xl pb-3 text-center"><i class="fa-solid fa-desktop pr-2"></i>アイテム一覧</p>
          <div class="flex flex-col items-center">
            <%= render 'posts/template/form_template', form: form %>
            <div id="gadget-display-item-container" class="grid grid-cols-1 md:grid-cols-3 gap-5 grid-flow-row p-4">
              <% if @post.gadgets.ids.present? %>
                <% @post.gadgets.each_with_index do |gadget, index| %>
                  <div id="subitem_<%= index + 10000 %>" class="flex flex-col bg-white shadow rounded-lg text-base p-4 relative">
                    <p id="main_form_brand_display" class="badge bg-slate-200"><%= gadget.brand %></p>
                    <div class="flex justify-center py-2 h-2/3">
                      <%= image_tag gadget.image_url, class: "h-24 w-32 shadow object-contain" %>
                    </div>
                    <div class="flex-grow flex flex-col">
                      <p id="main_form_name_display" class="text-center p-2 h-16"><%= truncate_name(gadget.name) %></p>
                      <p id="main_form_price_display" class="text-right font-bold">¥<%= number_with_delimiter(gadget.price) %></p>
                      <p id="main_form_genre_display" class="text-right border-t"><%= gadget.genre %></p>
                      <div class="flex justify-end mt-1">
                        <button type="button" id="main_form_delete_btn_<%= index + 10000 %>" class="cancel-btn w-1/3" data-controller="form-btn" data-action="click->form-btn#delete" data-form-btn-target="deleteBtn">削除</button>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>

            <div id="gadget-hidden-display-item-container">
              <% if @post.gadgets.ids.present? %>
                <% @post.gadgets.each_with_index do |gadget, index| %>
                  <%= form.fields_for :gadgets, gadget, child_index: index + 10000 do |gadget_form| %>
                    <div id="gadget-fields_<%= index + 10000 %>" class="hidden">
                      <%= gadget_form.text_field :genre %>
                      <%= gadget_form.url_field :image_url %>
                      <%= gadget_form.text_field :name %>
                      <%= gadget_form.text_field :brand %>
                      <%= gadget_form.number_field :price %>
                      <%= gadget_form.text_field :maker_name %>
                      <%= gadget_form.number_field :maker_code %>
                      <%= gadget_form.url_field :product_url %>
                      <%= gadget_form.text_field :product_id %>
                      <%= gadget_form.number_field :_destroy, id: "delete_flag_#{index + 10000}" %>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <%= form.submit '登録する', class: 'base-btn w-24 h-12 mt-10 mb-10' %>
    </div>

  <% end %>
  <%= render 'posts/modal_gadget' %>
</div>